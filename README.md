QueryBuilder
============
A straight forward and easy-to-use SQL query builder for simple DML and DQL queries.

<p align="center">
    <a href="https://packagist.org/packages/jayrods/querybuilder">
        <img src="./resources/img/logo.png" alt="Package logo"></img>
    </a>
</p>
<p align="center">
    <a href="LICENSE">
        <img src="https://img.shields.io/github/license/Jadersonrilidio/querybuilder?style=flat-square" alt="Software License"></img>
    </a>
    <a href="https://packagist.org/packages/jayrods/querybuilder">
        <img src="https://img.shields.io/github/downloads/Jadersonrilidio/querybuilder/total?style=flat-square" alt="Downloads"></img>
    </a>
    <a href="https://github.com/Jadersonrilidio/querybuilder/releases">
        <img src="https://img.shields.io/github/v/release/Jadersonrilidio/querybuilder?style=flat-square" alt="Latest Version"></img>
    </a>
    <a href="https://packagist.org/packages/jayrods/querybuilder">
        <img src="https://img.shields.io/github/languages/code-size/Jadersonrilidio/querybuilder?style=flat-square" alt="Code Size"></img>
    </a>

    
</p>


## About

**Writing hard coded SQL queries is a subject of great concern amongst developers!**
It not just lets your code 'dirty' (as some PHP purists might say) but also affects
testability, simplicity and impose more work over development. With those in mind
this package comes in handy with a simple approach of wrapping SQL queries into PHP
classes and methods, providing an abstraction with easy-to-use syntax and extra
features to assert the queries are being written accordingly.

NOTE: Bear in mind this package was developed for educational purposes goal.


## Installation

Installation is super-easy via [Composer](https://getcomposer.org/):

```bash
$ composer require jayrods/querybuilder
```

or add it by hand to your `composer.json` file.


## Upgrading

We follow [semantic versioning](https://semver.org/), which means breaking
changes may occur between major releases. We would introduce upgrading guides
whenever major version releases becomes available [here](UPGRADING.md).


## Basic Usage

Before start using the component, it's important to know how it is structured.
The QueryBuilder component is divided among 4 different use-cases, each
representing one CRUD operation (Create, Read, Update and Delete). However
for simplicity sake, the component makes available a QueryBuilderFactory object,
in which could be used to create all different QueryBuilders according to use-case.

Follows an example script using the component:

```php
// Declare class with namespace to use the component
use Jayrods\QueryBuilder\QueryBuilder;

// QueryBuilderFactory instance, which provides access to all QueryBuilder according to use-case.
$builderFactory = new QueryBuilder();

// Use the $builderFactory to create a SELECT queryBuilder use-case.
$builder = new $builderFactory->create(QueryBuilder::SELECT);

// Then this builder could be used as many times is needed to write SELECT type queries.
$query  = $builder->selectFrom('users')
    ->column('uuid')
    ->columnAs('name', 'username')
    ->column('email')
    ->where('uuid', '=', 'uuid')
    ->build();

echo $query;
```
Output:

```sql
"SELECT users.uuid, users.name AS username, users.email FROM users WHERE uuid = :uuid"
```

**NOTE:** The `build()` method returns the built query and save it internaly,
providing a `query()` method to return this saved query. After calling the
`build()` method all object's properties are reset to default, allowing
the object to start building a next query.

The `$builder` object also enable the partially construction fo the query,
providing more flexibility to build the query:

```php
// Constructing the same query from above, but separately.
$builder->selectFrom('users');

$builder->column('uuid');
$builder->column('email');
$builder->columnAs('name', 'username');

$builder->where('uuid', '=', 'uuid');

$query = $builder->build();

// Output: "SELECT users.uuid, users.name AS username, users.email FROM users WHERE uuid = :uuid"
echo $query;
```


## Getting Started

After installing the package via [Composer](https://getcomposer.org/)
you should simply instanciate the QueryBuilder object as bellow:

```php
use Jayrods\QueryBuilder\QueryBuilder;

$builderFactory = new QueryBuilder();
```

The `$builderFactory` object is actually a factory, which have a `QueryBuilder::create`
method to resolve and instantiate the suited QueryBuilder class for each CRUD use-case.
Follow bellow examples of the CRUD instances generated by the `create` method:

```php
// Used to build DELETE-type queries.
$builder = $builderFactory->create(QueryBuilder::DELETE);

// Used to build INSERT-type queries.
$builder = $builderFactory->create(QueryBuilder::INSERT);

// Used to build SELECT-type queries.
$builder = $builderFactory->create(QueryBuilder::SELECT);

// Used to build UPDATE-type queries.
$builder = $builderFactory->create(QueryBuilder::UPDATE);
```

where class constants have the values:

```php
QueryBuilder::DELETE = 'delete';
QueryBuilder::INSERT = 'insert';
QueryBuilder::SELECT = 'select';
QueryBuilder::UPDATE = 'update';
```

by convention, we encourage you to use the provided constants for a
more readable and standardized code instead of use the string values directly.


### Building Queries

For each CRUD use-case instance you will have different available methods to
build a query. Conventionally to start building a query you must call the
starter method with the names matching the SQL syntax as 'selectFrom',
'insertInto', 'delete', 'update'; and finish the building and getting the
query string using the commom method 'build', as shown in the examples bellow:

Example for build DELETE queries.

```php
$builder = $builderFactory->create(QueryBuilder::DELETE);

$query = $builder->delete('table')
    ->where('id', '=', 'id')
    ->build();

$result = "DELETE FROM table WHERE id = :id";
```

Example for build INSERT queries.

```php
$builder = $builderFactory->create(QueryBuilder::INSERT);

$query = $builder->insertInto('table')
    ->column('first')
    ->column('second')
    ->column('third')
    ->build();

$result = "INSERT INTO table (first, second, third) VALUES (:first, :second, :third)";
```
Example for build SELECT queries.

```php
$builder = $builderFactory->create(QueryBuilder::SELECT);

$query = $builder->selectFrom('table')
    ->build();

$result = "SELECT * FROM table";
```

Example for build UPDATE queries.

```php
$builder = $builderFactory->create(QueryBuilder::UPDATE);

$query = $builder->update('table')
    ->column('name')
    ->column('email')
    ->where('id', '=', 'id')
    ->build();

$result = "UPDATE table SET name = :name, email = :email WHERE id = :id";
```

A Depper explanation of each use-case could be seen bellow:


#### DELETE Queries



Example of a DELETE query use-case:

```php
use Jayrods\QueryBuilder\QueryBuilder;

$builderFactory = new QueryBuilder();

$builder = $builderFactory->create(QueryBuilder::DELETE);

$query = $builder->delete('users')
    ->where('birth_date', '<', 'birth_date')
    ->or('name', 'LIKE', 'Noah')
    ->build();

```

#### INSERT Queries
#### SELECT Queries
#### UPDATE Queries

### Environment variables options
### Customization options
### Advanced options

## Limitations

### Tips
### Comments
### Use Notes

When a new developer clones your codebase, they will have an additional
one-time step to manually copy the `.env.example` file to `.env` and fill-in
their own values (or get any sensitive values from a project co-worker).


## Security

If you discover a security vulnerability within this package, please report the issue or send an
email to [jayrods](jaderson.rodrigues@yahoo.com). All security vulnerabilities
will be promptly addressed. We appreciate your concern.


## License

QueryBuilder is licensed under [The GPL V3.0 License](LICENSE).
